\chapter*[Conclusions]{Conclusions}
    \addcontentsline{toc}{chapter}{Conclusions}

    In this work, the Linear Optics from Closed Orbit (LOCO) method was studied and implemented as a Python package for the Sirius storage ring. The code was submitted to several tests, using Orbit Response Matrices (ORM) obtained with simulations and measurements performed in the storage ring as well. The tests validated that the implemented method is robust and reliable. In these tests, the use of Levenberg-Marquardt (LM) minimization algorithm instead of Gauss-Newton (GN) proved to be the best choice to facilitate the singular values selection process required for fit parameters calculations. With this choice, only the last singular value, which is related to the well-known gain degeneracy in the vertical plane, should be removed. The LM algorithm has proved to be a great alternative for the time-consuming process of trial and error to determine the best set of singular values to be used in the fitting with GN algorithm. Another very important feature for the method was the constraints in quadrupole's strengths. Without constraints, the fitting converges to unrealistic solutions with large deviations on the gradients in quasi-degenerated quadrupoles (with similar signatures on ORM). Including constraints in step sizes, the solutions obtained reached the same quality of fitting with the advantage of providing much more realistic and feasible gradients variations.
    
    LOCO method was applied on Sirius storage ring to correct the linear optics and coupling. The fit parameters error bars were obtained by measuring and fitting 10 ORMs. An individual quadrupole gradient in the lattice was intentionally changed, the ORM was measured and adjusted to prove that the method was able to accurately recover the localized variation. The ORM measured without optics and coupling corrections on storage ring were adjusted with LOCO with 20 different initial conditions on the quadrupoles gradients and all solutions obtained virtually converged to the same setting of quadrupoles, within the parameters error bars, indicating that the solution found provides the best ORM fit available. With two LOCO iterations, where the corrections were applied in quadrupoles trim-coils and skew quadrupoles at Sirius storage ring, another ORM as measured and adjusted with the method. The measured and nominal ORM difference was reduced from $\chi = \SI{24.6}{\micro\meter}$ to $\SI{2.1}{\micro\meter}$. The errors of diagonal ORM blocks were reduced to about \sfrac{1}{9} from its initial values and the off-diagonal blocks related to the coupling were greatly reduced to approximately \sfrac{1}{20} of the initial errors. While the measured BPM accuracy was around $\SI{200}{\nano\meter}$, the LOCO fitting level for the ORM in these iterations was about $\SI{920}{\nano\meter}$. Although a sub-$\SI{}{\micro\meter}$ level of fitting is already satisfactory, this factor of 4 larger than the BPM accuracy indicates that there are still some systematic errors in the storage ring contributing to the ORM measurement that should be investigated. The dispersion functions had to be included in the fitting with a weight factor, otherwise, the differences between measured and fitted horizontal dispersion were very large. The measured vertical dispersion function could not be explained with the calibrated model. 
    
    The final corrections applied in Sirius storage ring for normal gradients covered a range of $\pm\SI{2}{\%}$ and for skew gradients, the range was $\pm\SI{5e-3}{\meter^{-1}}$. Some independent measurements were performed to characterize the storage ring optics, coupling and performance before and after corrections. A summary of the obtained results is presented in Table~\ref{tab:params_corr_summary}.
\begin{table}
    \centering
    \caption{Summary of storage ring parameters before and after LOCO corrections}
    \label{tab:params_corr_summary}
    \begin{tabular}{ccccc}
        \toprule\toprule
        Parameter & Before Corr. & After Corr. & Unit & Improvement Factor\\
        \hline
        $\Delta\beta_x/\beta_x$ (std) & \num{12.8(8)} & \num{3.9(8)} & \SI{}{\%} & \num{3.3} \\
        $\Delta\beta_y/\beta_y$ (std) & \num{10.4(5)} & \num{4.1(5)} & \SI{}{\%} & \num{2.5} \\
        $\Delta\eta_x$ (std) &  \num{10.2(2)} &  \num{1.6(2)} & \SI{}{\milli\meter} & \num{6.4} \\
        $\Delta\eta_y$ (std) &  \num{2.8(3)} &  \num{1.9(3)} & \SI{}{\milli\meter}& \num{1.5} \\
        % Betatron Coupling $|\kappa|$ &  \num{0.78(4)} & \num{0.07(1)} & \SI{}{\%} & \num{11.14} \\
        H. Dynamic Aperture  & \num{7.6} & \num{8.3} & \SI{}{\milli\meter} & \num{1.1} \\
        Injection Efficiency (mean)  & \num{20} & \num{68} & \SI{}{\%} & \num{3.4} \\
        \bottomrule\bottomrule
    \end{tabular}
\end{table}

Regarding the coupling, the measured global betatron coupling was reduced from $\SI{0.78(4)}{\%}$ to $\SI{0.07(1)}{\%}$, proving that LOCO is a robust tool to minimize both the off-diagonal ORM components and the global coupling as well. Initially, the calibrated LOCO model predicted the optics functions quite well compared to the measured values (except for the vertical dispersion). In the last fitting, after corrections application, this correspondence was not observed anymore. 

The orbit contribution to the optics and coupling on Sirius storage ring was also studied. The measured residual orbit with respect to the~\gls{bba} orbit was reproduced in the model. An ORM was calculated in this perturbed model and adjusted with LOCO. The model behavior, in this case, was similar to the obtained in the first iteration in the actual storage ring. The obtained optics errors caused by the orbit distortion in the model via the feed-down effect were on the same order compared to the errors measured in the storage ring without corrections. The horizontal and vertical dispersion function errors in both cases presented a substantial correlation. It was also necessary to include the dispersion function in the fitting with a weight factor to adjust the perturbed model dispersion. The vertical dispersion also could not be explained with LOCO model. The changes in quadrupole gradients and skew quadrupoles to fit the perturbed ORM was also on the order of magnitude of the corrections applied to the machine. All these results indicate that the residual orbit present in Sirius storage ring was perturbing considerably the optics and coupling by feed-down effect on quadrupoles and sextupoles. Moreover, the corrections calculated with LOCO and applied to the machine might be compensating for these errors generated by the orbit distortion. We concluded that the storage ring status obtained reached the limit allowed for this kind of compensation. To improve even further the parameters, the feed-down effect must be minimized by reducing the residual orbit. At the time of writing, the orbit correction was limited by the correctors kicks thresholds $\pm\SI{330}{\micro\radian}$, which should be sufficient to correct the orbit at the BPMs in a better level, considering the magnet alignment errors tolerances. Measurements in the storage ring indicated that the actual errors were not meeting specifications and a realignment campaign was scheduled for January 2021. After that, it is expected that the residual orbit can be greatly reduced, consequently the related optics perturbations and, applying the LOCO method implemented in this work, the storage ring linear optics and performance might be further improved towards design values. 
\section*{Future Activities}
The Sirius commissioning is a work in progress and there are many subsequent activities related to this work. As already mentioned, the analysis and corrections of storage ring optics and coupling will be performed after the machine realignment. Once the diagnostic beamline is available, it will be possible to use beam size and emittance measurements as an independent verification for the effect of the corrections on the beam. 

The Python code is planned to be generalized in the way of being able to run with any given lattice model, not only for the Sirius storage ring model. There is also an idea of implementing a graphical user interface in Python for the developed LOCO code, compatible with Sirius control system, then facilitating LOCO configuration setup, fitting, analysis, visualization of results and corrections application to the machine. This would make this LOCO Python version an user-friendly helpful tool for regular operations and machine studies on Sirius. 

LOCO analysis can be performed with ORM measured with different conditions on Sirius storage ring. Different kicks amplitudes can be used in ORM measurements to check the non-linear contributions to the matrix. The effects of measuring ORMs with different energy deviations (off-energy orbits) may also be studied. The sextupoles setup can be varied to change the betatron tunes dependence with energy deviations (the chromaticity) in the ORM measurements and LOCO fittings.

Since the ORM measurement process takes about 40 minutes, the obtained data is subjected to drifts in the machine which may add errors to the ORM. Other facilities implemented a much faster and accurate ORM measurement, exciting the beam orbit with different known frequencies oscillations on corrector's kicks. Applying Fourier analysis on the data, the ORM elements can be obtained. With this method the ORM can be measured in a few minutes and LOCO analysis can be applied, then reducing the overall time required for Sirius optics studies.

ORM can be measured with different currents per bunch in the electron beam. The corresponding LOCO fitting for each measurement can provide information about the transverse impedance distribution around Sirius storage ring.  
Another branch of study is to benchmark LOCO results and corrections with other methods, for example, methods based on~\gls{tbt} data acquired from~\glspl{bpm}, such as~\gls{pca} and Independent Component Analysis (ICA), which also fits optics function in the lattice model and provides variations in fit parameters that can be applied as corrections on the machine.